(function(){var g,E,u,m,y,k,F,G,H,z,I,A,w,J,B,x,K=[].slice,L={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)L.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};g=this.jQuery;var p=function(a,b){this.$el=g(a);this.options=g.extend({},this.defaults,b)};p.prototype.defaults={};p.prototype.destroy=function(){return this._deinit()};p.prototype._init=function(){return null};p.prototype._deinit=function(){return null};p.register=
function(a,b){var c,d,f,j;j=function(){return"simple_widget_"+b};d=function(b,c){var d,f,n,e,q;d=j();e=0;for(q=b.length;e<q;e++)f=b[e],n=new a(f,c),g.data(f,d)||g.data(f,d,n),n._init();return b};f=function(a){var b,c,d,f,e,q;b=j();q=[];f=0;for(e=a.length;f<e;f++)c=a[f],(d=g.data(c,b))&&d instanceof p&&d.destroy(),q.push(g.removeData(c,b));return q};c=function(a,b,c){var d,f,e,q,i;f=null;q=0;for(i=a.length;q<i;q++)if(d=a[q],(d=g.data(d,j()))&&d instanceof p)(e=d[b])&&"function"===typeof e&&(f=e.apply(d,
c));return f};return g.fn[b]=function(){var a,b;b=arguments[0];a=2<=arguments.length?K.call(arguments,1):[];if(void 0===b||"object"===typeof b)return d(this,b);if("string"===typeof b&&"_"!==b[0])return"destroy"===b?f(this):c(this,b,a)}};this.SimpleWidget=p;var l=function(){return l.__super__.constructor.apply(this,arguments)};i(l,p);l.is_mouse_handled=!1;l.prototype._init=function(){this.$el.bind("mousedown.mousewidget",g.proxy(this._mouseDown,this));this.is_mouse_started=!1;this.mouse_delay=0;this._mouse_delay_timer=
null;return this._is_mouse_delay_met=!0};l.prototype._deinit=function(){var a;this.$el.unbind("mousedown.mousewidget");a=g(document);a.unbind("mousemove.mousewidget");return a.unbind("mouseup.mousewidget")};l.prototype._mouseDown=function(a){var b;if(!l.is_mouse_handled&&(this.is_mouse_started||this._mouseUp(a),1===a.which&&this._mouseCapture(a)))return this.mouse_down_event=a,b=g(document),b.bind("mousemove.mousewidget",g.proxy(this._mouseMove,this)),b.bind("mouseup.mousewidget",g.proxy(this._mouseUp,
this)),this.mouse_delay&&this._startMouseDelayTimer(),a.preventDefault(),this.is_mouse_handled=!0};l.prototype._startMouseDelayTimer=function(){var a=this;this._mouse_delay_timer&&clearTimeout(this._mouse_delay_timer);this._mouse_delay_timer=setTimeout(function(){return a._is_mouse_delay_met=!0},this.mouse_delay);return this._is_mouse_delay_met=!1};l.prototype._mouseMove=function(a){if(this.is_mouse_started)return this._mouseDrag(a),a.preventDefault();if(this.mouse_delay&&!this._is_mouse_delay_met)return!0;
(this.is_mouse_started=!1!==this._mouseStart(this.mouse_down_event))?this._mouseDrag(a):this._mouseUp(a);return!this.is_mouse_started};l.prototype._mouseUp=function(a){var b;b=g(document);b.unbind("mousemove.mousewidget");b.unbind("mouseup.mousewidget");this.is_mouse_started&&(this.is_mouse_started=!1,this._mouseStop(a));return!1};l.prototype._mouseCapture=function(){return!0};l.prototype._mouseStart=function(){return null};l.prototype._mouseDrag=function(){return null};l.prototype._mouseStop=function(){return null};
m=l;this.Tree={};g=this.jQuery;A=function(a,b){var c,d,f,j;if(a.indexOf)return a.indexOf(b);c=f=0;for(j=a.length;f<j;c=++f)if(d=a[c],d===b)return c;return-1};this.Tree.indexOf=A;null!=this.JSON&&null!=this.JSON.stringify&&"function"===typeof this.JSON.stringify||(w=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,J={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},B=function(a){w.lastIndex=0;return w.test(a)?
'"'+a.replace(w,function(a){var c;c=J[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},x=function(a,b){var c,d,f,j,e;j=b[a];switch(typeof j){case "string":return B(j);case "number":return isFinite(j)?String(j):"null";case "boolean":case "null":return String(j);case "object":if(!j)return"null";d=[];if("[object Array]"===Object.prototype.toString.apply(j)){c=f=0;for(e=j.length;f<e;c=++f)d[c]=x(c,j)||"null";return 0===d.length?"[]":"["+d.join(",")+
"]"}for(c in j)Object.prototype.hasOwnProperty.call(j,c)&&(f=x(c,j))&&d.push(B(c)+":"+f);return 0===d.length?"{}":"{"+d.join(",")+"}"}},null==this.JSON&&(this.JSON={}),this.JSON.stringify=function(a){return x("",{"":a})});I=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};k={getName:function(a){return k.strings[a-1]},nameToIndex:function(a){var b,c,d;b=c=1;for(d=k.strings.length;1<=d?c<=
d:c>=d;b=1<=d?++c:--c)if(k.strings[b-1]===a)return b;return 0},BEFORE:1,AFTER:2,INSIDE:3,NONE:4,strings:["before","after","inside","none"]};this.Tree.Position=k;var h=function(a){this.setData(a);this.children=[];this.parent=null};h.prototype.setData=function(a){var b,c,d;if("object"!==typeof a)return this.name=a;d=[];for(b in a)c=a[b],"label"===b?d.push(this.name=c):d.push(this[b]=c);return d};h.prototype.initFromData=function(a){var b,c=this;b=function(a){var b,j,e,g;e=0;for(g=a.length;e<g;e++)b=
a[e],j=new h(""),j.initFromData(b),c.addChild(j);return null};c.setData(a);a.children&&b(a.children);return null};h.prototype.loadFromData=function(a){var b,c,d,f;this.children=[];d=0;for(f=a.length;d<f;d++)c=a[d],b=new h(c),this.addChild(b),"object"===typeof c&&c.children&&b.loadFromData(c.children);return null};h.prototype.addChild=function(a){this.children.push(a);return a._setParent(this)};h.prototype.addChildAtPosition=function(a,b){this.children.splice(b,0,a);return a._setParent(this)};h.prototype._setParent=
function(a){this.parent=a;this.tree=a.tree;return this.tree.addNodeToIndex(this)};h.prototype.removeChild=function(a){var b=this;a.iterate(function(a){b.tree.removeNodeFromIndex(a);return!0});this.children.splice(this.getChildIndex(a),1);return this.tree.removeNodeFromIndex(a)};h.prototype.getChildIndex=function(a){return g.inArray(a,this.children)};h.prototype.hasChildren=function(){return 0!==this.children.length};h.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};h.prototype.iterate=
function(a){var b,c=this;b=function(d,f){var j,e,g,i,h;if(d.children){h=d.children;g=0;for(i=h.length;g<i;g++)j=h[g],e=a(j,f),c.hasChildren()&&e&&b(j,f+1);return null}};b(this,0);return null};h.prototype.moveNode=function(a,b,c){if(!a.isParentOf(b)){a.parent.removeChild(a);if(c===k.AFTER)return b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)+1);if(c===k.BEFORE)return b.parent.addChildAtPosition(a,b.parent.getChildIndex(b));if(c===k.INSIDE)return b.addChildAtPosition(a,0)}};h.prototype.getData=
function(){var a;a=function(b){var c,d,f,j,e,g,i;c=[];g=0;for(i=b.length;g<i;g++){f=b[g];j={};for(d in f)e=f[d],"parent"!==d&&("children"!==d&&"element"!==d&&"tree"!==d)&&Object.prototype.hasOwnProperty.call(f,d)&&(j[d]=e);f.hasChildren()&&(j.children=a(f.children));c.push(j)}return c};return a(this.children)};h.prototype.getNodeByName=function(a){var b;b=null;this.iterate(function(c){return c.name===a?(b=c,!1):!0});return b};h.prototype.addAfter=function(a){var b;return this.parent?(b=new h(a),a=
this.parent.getChildIndex(this),this.parent.addChildAtPosition(b,a+1),b):null};h.prototype.addBefore=function(a){var b;return this.parent?(b=new h(a),a=this.parent.getChildIndex(this),this.parent.addChildAtPosition(b,a)):null};h.prototype.addParent=function(a){var b,c,d,f,j;if(this.parent){b=new h(a);b._setParent(this.tree);c=this.parent;j=c.children;d=0;for(f=j.length;d<f;d++)a=j[d],b.addChild(a);c.children=[];c.addChild(b);return b}return null};h.prototype.remove=function(){if(this.parent)return this.parent.removeChild(this),
this.parent=null};h.prototype.append=function(a){a=new h(a);this.addChild(a);return a};h.prototype.prepend=function(a){a=new h(a);this.addChildAtPosition(a,0);return a};h.prototype.isParentOf=function(a){for(a=a.parent;a;){if(a===this)return!0;a=a.parent}return!1};var t=function(a){t.__super__.constructor.call(this,a,null,!0);this.id_mapping={};this.tree=this};i(t,h);t.prototype.getNodeById=function(a){return this.id_mapping[a]};t.prototype.addNodeToIndex=function(a){if(a.id)return this.id_mapping[a.id]=
a};t.prototype.removeNodeFromIndex=function(a){if(a.id)return delete this.id_mapping[a.id]};z=t;this.Tree.Tree=z;this.Tree.Node=h;var e=function(){return e.__super__.constructor.apply(this,arguments)};i(e,m);e.prototype.defaults={autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!1,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,autoEscape:!0,dataUrl:null,slide:!0};e.prototype.toggle=function(a,b){null==
b&&(b=!0);return a.is_open?this.closeNode(a,b):this.openNode(a,b)};e.prototype.getTree=function(){return this.tree};e.prototype.selectNode=function(a){return this.select_node_handler.selectNode(a)};e.prototype.getSelectedNode=function(){return this.selected_node||!1};e.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};e.prototype.loadData=function(a,b){return this._loadData(a,b)};e.prototype.loadDataFromUrl=function(a,b,c){var d,f,j=this;d=null;f=function(){if(d)return d.removeClass("loading")};
var e;b&&(e=new u(b,j),d=e.getLi(),d.addClass("jqtree-loading"));"string"===g.type(a)&&(a={url:a});a.method||(a.method="get");return g.ajax({url:a.url,data:a.data,type:a.method.toUpperCase(),cache:!1,dataType:"json",success:function(a){a=g.isArray(a)||"object"===typeof a?a:g.parseJSON(a);f();j._loadData(a,b);if(c)return c()}})};e.prototype._loadData=function(a,b){var c,d,f,j;this._triggerEvent("tree.load_data",{tree_data:a});if(b){c=new h("");c._setParent(b.tree);c.loadFromData(a);j=c.children;d=
0;for(f=j.length;d<f;d++)c=j[d],b.addChild(c);this._refreshElements(b.parent)}else this._initTree(a);if(this.is_dragging)return this.dnd_handler.refreshHitAreas()};e.prototype.getNodeById=function(a){return this.tree.getNodeById(a)};e.prototype.getNodeByName=function(a){return this.tree.getNodeByName(a)};e.prototype.openNode=function(a,b){null==b&&(b=!0);return this._openNode(a,b)};e.prototype._openNode=function(a,b,c){var d,f,j=this;null==b&&(b=!0);d=function(a,b,c){return(new u(a,j)).open(c,b)};
if(a.isFolder()){if(a.load_on_demand)return this._loadFolderOnDemand(a,b,c);for(f=a.parent;f&&!f.is_open;)f.parent&&d(f,!1,null),f=f.parent;d(a,b,c);return this._saveState()}};e.prototype._loadFolderOnDemand=function(a,b,c){var d=this;null==b&&(b=!0);a.load_on_demand=!1;return this.loadDataFromUrl(this._getDataUrlInfo(a),a,function(){return d._openNode(a,b,c)})};e.prototype.closeNode=function(a,b){null==b&&(b=!0);if(a.isFolder())return(new u(a,this)).close(b),this._saveState()};e.prototype.isDragging=
function(){return this.is_dragging};e.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()};e.prototype.addNodeAfter=function(a,b){var c;c=b.addAfter(a);this._refreshElements(b.parent);return c};e.prototype.addNodeBefore=function(a,b){var c;c=b.addBefore(a);this._refreshElements(b.parent);return c};e.prototype.addParentNode=function(a,b){var c;c=b.addParent(a);this._refreshElements(c.parent);return c};e.prototype.removeNode=function(a){var b,c=this;if(b=a.parent)return function(){var b;
if(c.selected_node){if(c.selected_node===a)return!0;b=!0;iterate(function(c){return a===c?(b=!0,!1):!0});return b}return!1}()&&(this.selected_node=null),a.remove(),this._refreshElements(b.parent)};e.prototype.appendNode=function(a,b){var c,d;b||(b=this.tree);c=b.isFolder();d=b.append(a);c?this._refreshElements(b):this._refreshElements(b.parent);return d};e.prototype.prependNode=function(a,b){var c;b||(b=this.tree);c=b.prepend(a);this._refreshElements(b);return c};e.prototype.updateNode=function(a,
b){a.setData(b);this._refreshElements(a.parent);return this.select_node_handler.selectCurrentNode()};e.prototype.moveNode=function(a,b,c){c=k.nameToIndex(c);this.tree.moveNode(a,b,c);return this._refreshElements()};e.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};e.prototype._init=function(){e.__super__._init.call(this);this.element=this.$el;this.selected_node=null;this.mouse_delay=300;this.save_state_handler=new F(this);this.select_node_handler=new H(this);
this.dnd_handler=new E(this);this.scroll_handler=new G(this);this._initData();this.element.click(g.proxy(this._click,this));return this.element.bind("contextmenu",g.proxy(this._contextmenu,this))};e.prototype._deinit=function(){this.element.empty();this.element.unbind();this.tree=null;return e.__super__._deinit.call(this)};e.prototype._initData=function(){return this.options.data?this.loadData(this.options.data):this.loadDataFromUrl(this._getDataUrlInfo())};e.prototype._getDataUrlInfo=function(a){var b;
b=this.options.dataUrl||this.element.data("url");if(g.isFunction(b))return b(a);"string"===g.type(b)&&(b={url:b},a&&a.id&&(a={node:a.id},b.data=a));return b};e.prototype._initTree=function(a){this.tree=new z;this.tree.loadFromData(a);this._openNodes();this._refreshElements();this.select_node_handler.selectCurrentNode();return this._triggerEvent("tree.init")};e.prototype._openNodes=function(){var a;if((!this.options.saveState||!this.save_state_handler.restoreState())&&!1!==this.options.autoOpen)return a=
!0===this.options.autoOpen?-1:parseInt(this.options.autoOpen),this.tree.iterate(function(b,c){b.is_open=!0;return c!==a})};e.prototype._refreshElements=function(a){var b,c,d,f,j,e,i,h,k=this;null==a&&(a=null);i=function(a){return k.options.autoEscape?I(a):a};j=function(a){return g('<ul class="jqtree_common '+(a?"jqtree-tree":"")+'"></ul>')};d=function(a){var b;b=a.isFolder()?c(a):f(a);if(k.options.onCreateLi)k.options.onCreateLi(a,b);return b};f=function(a){a=i(a.name);return g('<li class="jqtree_common"><div><span class="jqtree-title jqtree_common">'+
a+"</span></div></li>")};c=function(a){var b,c,d;b=["jqtree-toggler"];a.is_open||b.push("jqtree-closed");b=b.join(" ");c=["jqtree-folder"];a.is_open||c.push("jqtree-closed");d=c.join(" ");c=i(a.name);return g('<li class="jqtree_common '+d+'"><div><a class="jqtree_common '+b+'">'+(a.is_open?"&#x25bc;":"&#x25ba;")+'</a><span class="jqtree_common jqtree-title">'+c+"</span></div></li>")};e=function(a,b,c){var f,g,i,c=j(c);a.append(c);g=0;for(i=b.length;g<i;g++)f=b[g],a=d(f),c.append(a),f.element=a[0],
a.data("node",f),f.hasChildren()&&e(a,f.children,!1,f.is_open);return null};a&&a.parent?(h=!1,b=this._getNodeElementForNode(a),b.getUl().remove(),b=b.$element):(a=this.tree,b=this.element,b.empty(),h=!0);e(b,a.children,h,h);return this._triggerEvent("tree.refresh")};e.prototype._click=function(a){var b,c;if(!a.ctrlKey)if(b=g(a.target),c=b.closest(".jqtree-title"),c.length){if(b=this._getNode(c))return this._triggerEvent("tree.click",{node:b}),this.selectNode(b)}else if(b=b.closest(".jqtree-toggler"),
b.length&&(b=this._getNode(b)))return this.toggle(b,this.options.slide),a.preventDefault(),a.stopPropagation()};e.prototype._getNode=function(a){a=a.closest("li");return 0===a.length?null:a.data("node")};e.prototype._getNodeElementForNode=function(a){return a.isFolder()?new u(a,this):new y(a,this)};e.prototype._getNodeElement=function(a){return(a=this._getNode(a))?this._getNodeElementForNode(a):null};e.prototype._contextmenu=function(a){var b;b=g(a.target).closest("ul.jqtree-tree div");if(b.length&&
(b=this._getNode(b)))return a.preventDefault(),a.stopPropagation(),this._triggerEvent("tree.contextmenu",{node:b,click_event:a}),!1};e.prototype._saveState=function(){if(this.options.saveState)return this.save_state_handler.saveState()};e.prototype._mouseCapture=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseCapture(a):!1};e.prototype._mouseStart=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStart(a):!1};e.prototype._mouseDrag=function(a){return this.options.dragAndDrop?
(a=this.dnd_handler.mouseDrag(a),this.scroll_handler.checkScrolling(),a):!1};e.prototype._mouseStop=function(){return this.options.dragAndDrop?this.dnd_handler.mouseStop():!1};e.prototype._triggerEvent=function(a,b){var c;c=g.Event(a);g.extend(c,b);this.element.trigger(c);return c};e.prototype.testGenerateHitAreas=function(a){this.dnd_handler.current_item=this._getNodeElementForNode(a);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};p.register(e,"tree");var r=function(a,b,c){this.$element=
b;this.node=a;this.$ghost=g('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');c===k.AFTER?this.moveAfter():c===k.BEFORE?this.moveBefore():c===k.INSIDE&&(a.isFolder()&&a.is_open?this.moveInsideOpenFolder():this.moveInside())};r.prototype.remove=function(){return this.$ghost.remove()};r.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};r.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};
r.prototype.moveInsideOpenFolder=function(){return g(this.node.children[0].element).before(this.$ghost)};r.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};var C=function(a){var b;b=a.children("div");a=a.width()-4;this.$hint=g('<span class="jqtree-border"></span>');b.append(this.$hint);this.$hint.css({width:a,height:b.height()-4})};C.prototype.remove=function(){return this.$hint.remove()};m=function(a,b){this.init(a,b)};m.prototype.init=
function(a,b){this.node=a;this.tree_widget=b;return this.$element=g(a.element)};m.prototype.getUl=function(){return this.$element.children("ul:first")};m.prototype.getSpan=function(){return this.$element.children("div").find("span.jqtree-title")};m.prototype.getLi=function(){return this.$element};m.prototype.addDropHint=function(a){return a===k.INSIDE?new C(this.$element):new r(this.node,this.$element,a)};m.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};m.prototype.deselect=
function(){return this.getLi().removeClass("jqtree-selected")};y=m;var s=function(){return s.__super__.constructor.apply(this,arguments)};i(s,y);s.prototype.open=function(a,b){var c,d=this;null==b&&(b=!0);if(!this.node.is_open){this.node.is_open=!0;c=this.getButton();c.removeClass("jqtree-closed");c.html("&#x25bc;");c=function(){d.getLi().removeClass("jqtree-closed");a&&a();return d.tree_widget._triggerEvent("tree.open",{node:d.node})};if(b)return this.getUl().slideDown("fast",c);this.getUl().show();
return c()}};s.prototype.close=function(a){var b,c=this;null==a&&(a=!0);if(this.node.is_open){this.node.is_open=!1;b=this.getButton();b.addClass("jqtree-closed");b.html("&#x25ba;");b=function(){c.getLi().addClass("jqtree-closed");return c.tree_widget._triggerEvent("tree.close",{node:c.node})};if(a)return this.getUl().slideUp("fast",b);this.getUl().hide();return b()}};s.prototype.getButton=function(){return this.$element.children("div").find("a.jqtree-toggler")};s.prototype.addDropHint=function(a){return!this.node.is_open&&
a===k.INSIDE?new C(this.$element):new r(this.node,this.$element,a)};u=s;var D=function(a,b,c,d){this.offset_x=b;this.offset_y=c;this.$element=g('<span class="jqtree-title jqtree-dragging">'+a.name+"</span>");this.$element.css("position","absolute");d.append(this.$element)};D.prototype.move=function(a,b){return this.$element.offset({left:a-this.offset_x,top:b-this.offset_y})};D.prototype.remove=function(){return this.$element.remove()};i=function(a){this.tree_widget=a};i.prototype.saveState=function(){if(this.tree_widget.options.onSetStateFromStorage)return this.tree_widget.options.onSetStateFromStorage(this.getState());
if("undefined"!==typeof localStorage&&null!==localStorage)return localStorage.setItem(this.getCookieName(),this.getState());if(g.cookie)return g.cookie(this.getCookieName(),this.getState(),{path:"/"})};i.prototype.restoreState=function(){var a;return(a=this.getStateFromStorage())?(this.setState(a),!0):!1};i.prototype.getStateFromStorage=function(){return this.tree_widget.options.onGetStateFromStorage?this.tree_widget.options.onGetStateFromStorage():"undefined"!==typeof localStorage&&null!==localStorage?
localStorage.getItem(this.getCookieName()):g.cookie?g.cookie(this.getCookieName(),{path:"/"}):null};i.prototype.getState=function(){var a,b;a=[];this.tree_widget.tree.iterate(function(b){b.is_open&&(b.id&&b.hasChildren())&&a.push(b.id);return!0});b="";this.tree_widget.selected_node&&(b=this.tree_widget.selected_node.id);return JSON.stringify({open_nodes:a,selected_node:b})};i.prototype.setState=function(a){var b,c,d=this;if(a=g.parseJSON(a))return b=a.open_nodes,c=a.selected_node,this.tree_widget.tree.iterate(function(a){a.id&&
(a.hasChildren()&&0<=A(b,a.id))&&(a.is_open=!0);c&&a.id===c&&(d.tree_widget.selected_node=a);return!0})};i.prototype.getCookieName=function(){return"string"===typeof this.tree_widget.options.saveState?this.tree_widget.options.saveState:"tree"};F=i;i=function(a){this.tree_widget=a};i.prototype.selectNode=function(a){if(!this.tree_widget.options.onCanSelectNode||this.tree_widget.options.onCanSelectNode(a))if(this.tree_widget.selected_node&&(this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node).deselect(),
this.tree_widget.selected_node=null),a&&(this.tree_widget._getNodeElementForNode(a).select(),this.tree_widget.selected_node=a,this.tree_widget._triggerEvent("tree.select",{node:a}),a=this.tree_widget.selected_node.parent,a.is_open||this.tree_widget.openNode(a,!1)),this.tree_widget.options.saveState)return this.tree_widget.save_state_handler.saveState()};i.prototype.selectCurrentNode=function(){var a;if(this.tree_widget.selected_node&&(a=this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node)))return a.select()};
H=i;i=function(a){this.tree_widget=a;this.$ghost=this.hovered_area=null;this.hit_areas=[];this.is_dragging=!1};i.prototype.mouseCapture=function(a){a=g(a.target);if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(a))return null;(a=this.tree_widget._getNodeElement(a))&&this.tree_widget.options.onCanMove&&(this.tree_widget.options.onCanMove(a.node)||(a=null));this.current_item=a;return null!==this.current_item};i.prototype.mouseStart=function(a){this.refreshHitAreas();
a=this.getOffsetFromEvent(a);this.drag_element=new D(this.current_item.node,a[0],a[1],this.tree_widget.element);this.is_dragging=!0;this.current_item.$element.addClass("jqtree-moving");return!0};i.prototype.mouseDrag=function(a){var b;this.drag_element.move(a.pageX,a.pageY);if((a=this.findHoveredArea(a.pageX,a.pageY))&&this.tree_widget.options.onCanMoveTo)b=k.getName(a.position),this.tree_widget.options.onCanMoveTo(this.current_item.node,a.node,b)||(a=null);a?this.hovered_area!==a&&(this.hovered_area=
a,this.updateDropHint()):(this.removeDropHint(),this.removeHover(),this.stopOpenFolderTimer());return!0};i.prototype.mouseStop=function(){this.moveItem();this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();this.current_item.$element.removeClass("jqtree-moving");return this.is_dragging=!1};i.prototype.getOffsetFromEvent=function(a){var b;b=g(a.target).offset();return[a.pageX-b.left,a.pageY-b.top]};i.prototype.refreshHitAreas=function(){this.removeHitAreas();return this.generateHitAreas()};
i.prototype.removeHitAreas=function(){return this.hit_areas=[]};i.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};i.prototype.removeDropHint=function(){if(this.previous_ghost)return this.previous_ghost.remove()};i.prototype.removeHover=function(){return this.hovered_area=null};i.prototype.generateHitAreas=function(){var a,b,c,d,f,e=this;f=[];d=0;b=function(a){return a.offset().top};a=function(a,b,c){f.push({top:c,node:a,position:b});return d=c};this.iterateVisibleNodes(function(c,
d,f){f=b(f);c===e.current_item.node?a(c,k.NONE,f):a(c,k.INSIDE,f);return d===e.current_item.node||c===e.current_item.node?a(c,k.NONE,f):a(c,k.AFTER,f)},function(c,d){if(c===e.current_item.node)return!1;c.children[0]!==e.current_item.node&&a(c,k.INSIDE,b(d));return!0},function(c,d,f){f=b(f);if(c===e.current_item.node)return a(c,k.NONE,f);a(c,k.INSIDE,f);if(d!==e.current_item.node)return a(c,k.AFTER,f)},function(b,c){return b===e.current_item.node||c===e.current_item.node?a(b,k.NONE,d):a(b,k.AFTER,
d)},function(c){if(c!==e.current_item.node)return a(c,k.BEFORE,b(g(c.element)))});c=[];var i=function(a,b,d){var f,e,g,d=(d-b)/a.length;e=0;for(g=a.length;e<g;e++)f=a[e],c.push({top:b,bottom:b+d,node:f.node,position:f.position}),b+=d;return null},h,l,v,n,m;v=-1;h=[];n=0;for(m=f.length;n<m;n++)l=f[n],l.top!==v&&(h.length&&i(h,v,l.top),v=l.top,h=[]),h.push(l);i(h,v,e.tree_widget.element.offset().top+e.tree_widget.element.height());return this.hit_areas=c};i.prototype.iterateVisibleNodes=function(a,
b,c,d,f){var e,i;e=!0;i=function(h,k){var l,n,m,q,p;n=(h.is_open||!h.element)&&h.hasChildren();if(h.element){l=g(h.element);if(!l.is(":visible"))return;e&&(f(h,l),e=!1);h.hasChildren()?h.is_open?b(h,l)||(n=!1):c(h,k,l):a(h,k,l)}if(n){n=h.children.length;p=h.children;m=q=0;for(p=p.length;q<p;m=++q)m===n-1?i(h.children[m],null):i(h.children[m],h.children[m+1]);if(h.is_open)return d(h,k,l)}};return i(this.tree_widget.tree)};i.prototype.findHoveredArea=function(a,b){var c,d,e,g;c=this.tree_widget.element.offset();
if(a<c.left||b<c.top||a>c.left+this.tree_widget.element.width()||b>c.top+this.tree_widget.element.height())return null;e=0;for(d=this.hit_areas.length;e<d;)if(g=e+d>>1,c=this.hit_areas[g],b<c.top)d=g;else if(b>c.bottom)e=g+1;else return c;return null};i.prototype.updateDropHint=function(){var a;this.stopOpenFolderTimer();if(this.hovered_area)return a=this.hovered_area.node,a.isFolder()&&(!a.is_open&&this.hovered_area.position===k.INSIDE)&&this.startOpenFolderTimer(a),this.removeDropHint(),a=this.tree_widget._getNodeElementForNode(this.hovered_area.node),
this.previous_ghost=a.addDropHint(this.hovered_area.position)};i.prototype.startOpenFolderTimer=function(a){var b=this;return this.open_folder_timer=setTimeout(function(){return b.tree_widget._openNode(a,b.tree_widget.options.slide,function(){b.refreshHitAreas();return b.updateDropHint()})},500)};i.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer)return clearTimeout(this.open_folder_timer),this.open_folder_timer=null};i.prototype.moveItem=function(){var a,b,c,d,e,g=this;if(this.hovered_area&&
this.hovered_area.position!==k.NONE&&(c=this.current_item.node,e=this.hovered_area.node,d=this.hovered_area.position,b=c.parent,d===k.INSIDE&&(this.hovered_area.node.is_open=!0),a=function(){g.tree_widget.tree.moveNode(c,e,d);g.tree_widget.element.empty();return g.tree_widget._refreshElements()},b=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:c,target_node:e,position:k.getName(d),previous_parent:b,do_move:a}}),!b.isDefaultPrevented()))return a()};E=i;i=function(a){this.tree_widget=
a;this.previous_top=-1;this._initScrollParent()};i.prototype._initScrollParent=function(){var a,b,c=this;b=function(){c.scroll_parent_top=0;return c.$scroll_parent=null};"fixed"===this.tree_widget.$el.css("position")&&b();a:{var d,e,h,i,k,l,m,n;d=["overflow","overflow-y"];m=c.tree_widget.$el.parents();h=0;for(k=m.length;h<k;h++){e=m[h];i=0;for(l=d.length;i<l;i++)if(a=d[i],"auto"===(n=g.css(e,a))||"scroll"===n){a=g(e);break a}}a=null}return a&&a.length&&"HTML"!==a[0].tagName?(this.$scroll_parent=a,
this.scroll_parent_top=this.$scroll_parent.offset().top):b()};i.prototype.checkScrolling=function(){var a;if((a=this.tree_widget.dnd_handler.hovered_area)&&a.top!==this.previous_top)return this.previous_top=a.top,this.$scroll_parent?this._handleScrollingWithScrollParent(a):this._handleScrollingWithDocument(a)};i.prototype._handleScrollingWithScrollParent=function(a){if(20>this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-a.bottom)return this.$scroll_parent[0].scrollTop+=20,this.tree_widget.refreshHitAreas(),
this.previous_top=-1;if(20>a.top-this.scroll_parent_top)return this.$scroll_parent[0].scrollTop-=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1};i.prototype._handleScrollingWithDocument=function(a){if(20>a.top-g(document).scrollTop())return g(document).scrollTop(g(document).scrollTop()-20);if(20>g(window).height()-(a.bottom-g(document).scrollTop()))return g(document).scrollTop(g(document).scrollTop()+20)};G=i}).call(this);